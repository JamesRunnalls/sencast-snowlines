<graph id="idepix">
	<version>1.0</version>
	<node id="resamplingNode">
		<operator>S2Resampling</operator>
		<sources>
			<sourceProduct>${source}</sourceProduct>
		</sources>
		<parameters>
			<resolution>${resolution}</resolution>
			<resampleOnPyramidLevels>true</resampleOnPyramidLevels>
		</parameters>
    </node>
	<node id="subsetNode">
		<operator>Subset</operator>
		<sources>
			<sourceProduct>resamplingNode</sourceProduct>
		</sources>
		<parameters>
			<geoRegion>${wkt}</geoRegion>
		</parameters>
	</node>
	<node id="idepixNode">
		<operator>idepix.s2</operator>
		<sources>
			<sourceProduct>subsetNode</sourceProduct>
		</sources>
		<parameters>
			<computeCloudBuffer>true</computeCloudBuffer>
			<cloudBufferWidth>5</cloudBufferWidth>
		</parameters>
	</node>
	<node id="mergeNode">
		<operator>Merge</operator>
		<sources>
			<masterProduct>subsetNode</masterProduct>
			<sourceProducts>idepixNode</sourceProducts>
		</sources>
	</node>
	<node id="reprojectNode">
		<operator>Reproject</operator>
		<sources>
			<source>mergeNode</source>
		</sources>
		<parameters>
			<crs>EPSG:4326</crs>
			<resampling>Nearest</resampling>
			<referencePixelX>0</referencePixelX>
			<referencePixelY>0</referencePixelY>
			<easting>${easting}</easting>
			<northing>${northing}</northing>
			<pixelSizeX>${pixelSizeX}</pixelSizeX>
			<pixelSizeY>${pixelSizeY}</pixelSizeY>
			<width>${width}</width>
			<height>${height}</height>
			<noDataValue>NaN</noDataValue>
		</parameters>
	</node>
	<node id="writeNode">
		<operator>Write</operator>
		<sources>
			<source>reprojectNode</source>
		</sources>
		<parameters>
			<file>${output}</file>
			<formatName>NetCDF-BEAM</formatName>
		</parameters>
	</node>
</graph>